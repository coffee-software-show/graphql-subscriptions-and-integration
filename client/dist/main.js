(()=>{"use strict";function e(e){return null===e?"null":Array.isArray(e)?"array":typeof e}function t(t){return"object"===e(t)}function o(e,t){return e.length<124?e:t}const r="graphql-transport-ws";var n,i;function a(o){if(!t(o))throw new Error(`Message is expected to be an object, but got ${e(o)}`);if(!o.type)throw new Error("Message is missing the 'type' property");if("string"!=typeof o.type)throw new Error(`Message is expects the 'type' property to be a string, but got ${e(o.type)}`);switch(o.type){case i.ConnectionInit:case i.ConnectionAck:case i.Ping:case i.Pong:if("payload"in o&&!t(o.payload))throw new Error(`"${o.type}" message expects the 'payload' property to be an object or missing, but got "${o.payload}"`);break;case i.Subscribe:if("string"!=typeof o.id)throw new Error(`"${o.type}" message expects the 'id' property to be a string, but got ${e(o.id)}`);if(!o.id)throw new Error(`"${o.type}" message requires a non-empty 'id' property`);if(!t(o.payload))throw new Error(`"${o.type}" message expects the 'payload' property to be an object, but got ${e(o.payload)}`);if("string"!=typeof o.payload.query)throw new Error(`"${o.type}" message payload expects the 'query' property to be a string, but got ${e(o.payload.query)}`);if(null!=o.payload.variables&&!t(o.payload.variables))throw new Error(`"${o.type}" message payload expects the 'variables' property to be a an object or nullish or missing, but got ${e(o.payload.variables)}`);if(null!=o.payload.operationName&&"string"!==e(o.payload.operationName))throw new Error(`"${o.type}" message payload expects the 'operationName' property to be a string or nullish or missing, but got ${e(o.payload.operationName)}`);if(null!=o.payload.extensions&&!t(o.payload.extensions))throw new Error(`"${o.type}" message payload expects the 'extensions' property to be a an object or nullish or missing, but got ${e(o.payload.extensions)}`);break;case i.Next:if("string"!=typeof o.id)throw new Error(`"${o.type}" message expects the 'id' property to be a string, but got ${e(o.id)}`);if(!o.id)throw new Error(`"${o.type}" message requires a non-empty 'id' property`);if(!t(o.payload))throw new Error(`"${o.type}" message expects the 'payload' property to be an object, but got ${e(o.payload)}`);break;case i.Error:if("string"!=typeof o.id)throw new Error(`"${o.type}" message expects the 'id' property to be a string, but got ${e(o.id)}`);if(!o.id)throw new Error(`"${o.type}" message requires a non-empty 'id' property`);if(r=o.payload,!(Array.isArray(r)&&r.length>0&&r.every((e=>"message"in e))))throw new Error(`"${o.type}" message expects the 'payload' property to be an array of GraphQL errors, but got ${JSON.stringify(o.payload)}`);break;case i.Complete:if("string"!=typeof o.id)throw new Error(`"${o.type}" message expects the 'id' property to be a string, but got ${e(o.id)}`);if(!o.id)throw new Error(`"${o.type}" message requires a non-empty 'id' property`);break;default:throw new Error(`Invalid message 'type' property "${o.type}"`)}var r;return o}function s(e,t){return a(e),JSON.stringify(e,t)}function c(e){return t(e)&&"code"in e&&"reason"in e}!function(e){e[e.InternalServerError=4500]="InternalServerError",e[e.InternalClientError=4005]="InternalClientError",e[e.BadRequest=4400]="BadRequest",e[e.BadResponse=4004]="BadResponse",e[e.Unauthorized=4401]="Unauthorized",e[e.Forbidden=4403]="Forbidden",e[e.SubprotocolNotAcceptable=4406]="SubprotocolNotAcceptable",e[e.ConnectionInitialisationTimeout=4408]="ConnectionInitialisationTimeout",e[e.ConnectionAcknowledgementTimeout=4504]="ConnectionAcknowledgementTimeout",e[e.SubscriberAlreadyExists=4409]="SubscriberAlreadyExists",e[e.TooManyInitialisationRequests=4429]="TooManyInitialisationRequests"}(n||(n={})),function(e){e.ConnectionInit="connection_init",e.ConnectionAck="connection_ack",e.Ping="ping",e.Pong="pong",e.Subscribe="subscribe",e.Next="next",e.Error="error",e.Complete="complete"}(i||(i={})),window.addEventListener("load",(e=>{const t=function(e){const{url:t,connectionParams:l,lazy:p=!0,onNonLazyError:d=console.error,lazyCloseTimeout:y=0,keepAlive:u=0,disablePong:m,connectionAckWaitTimeout:g=0,retryAttempts:f=5,retryWait:b=async function(e){let t=1e3;for(let o=0;o<e;o++)t*=2;await new Promise((e=>setTimeout(e,t+Math.floor(2700*Math.random()+300))))},shouldRetry:w=c,isFatalConnectionProblem:h,on:x,webSocketImpl:E,generateID:v=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},jsonMessageReplacer:S,jsonMessageReviver:C}=e;let $;if(E){if(!("function"==typeof(k=E)&&"constructor"in k&&"CLOSED"in k&&"CLOSING"in k&&"CONNECTING"in k&&"OPEN"in k))throw new Error("Invalid WebSocket implementation provided");$=E}else"undefined"!=typeof WebSocket?$=WebSocket:"undefined"!=typeof global?$=global.WebSocket||global.MozWebSocket:"undefined"!=typeof window&&($=window.WebSocket||window.MozWebSocket);var k;if(!$)throw new Error("WebSocket implementation missing; on Node you can `import WebSocket from 'ws';` and pass `webSocketImpl: WebSocket` to `createClient`");const N=$,I=(()=>{const e=(()=>{const e={};return{on:(t,o)=>(e[t]=o,()=>{delete e[t]}),emit(t){var o;"id"in t&&(null===(o=e[t.id])||void 0===o||o.call(e,t))}}})(),t={connecting:(null==x?void 0:x.connecting)?[x.connecting]:[],opened:(null==x?void 0:x.opened)?[x.opened]:[],connected:(null==x?void 0:x.connected)?[x.connected]:[],ping:(null==x?void 0:x.ping)?[x.ping]:[],pong:(null==x?void 0:x.pong)?[x.pong]:[],message:(null==x?void 0:x.message)?[e.emit,x.message]:[e.emit],closed:(null==x?void 0:x.closed)?[x.closed]:[],error:(null==x?void 0:x.error)?[x.error]:[]};return{onMessage:e.on,on(e,o){const r=t[e];return r.push(o),()=>{r.splice(r.indexOf(o),1)}},emit(e,...o){for(const r of[...t[e]])r(...o)}}})();function P(e){const t=[I.on("error",(o=>{t.forEach((e=>e())),e(o)})),I.on("closed",(o=>{t.forEach((e=>e())),e(o)}))]}let T,A,q=0,M=!1,O=0,R=!1;async function W(){clearTimeout(A);const[e,p]=await(null!=T?T:T=new Promise(((e,p)=>(async()=>{if(M){if(await b(O),!q)return T=void 0,p({code:1e3,reason:"All Subscriptions Gone"});O++}I.emit("connecting");const d=new N("function"==typeof t?await t():t,r);let y,f;function w(){isFinite(u)&&u>0&&(clearTimeout(f),f=setTimeout((()=>{d.readyState===N.OPEN&&(d.send(s({type:i.Ping})),I.emit("ping",!1,void 0))}),u))}P((e=>{T=void 0,clearTimeout(y),clearTimeout(f),p(e),c(e)&&4499===e.code&&(d.close(4499,"Terminated"),d.onerror=null,d.onclose=null)})),d.onerror=e=>I.emit("error",e),d.onclose=e=>I.emit("closed",e),d.onopen=async()=>{try{I.emit("opened",d);const e="function"==typeof l?await l():l;if(d.readyState!==N.OPEN)return;d.send(s(e?{type:i.ConnectionInit,payload:e}:{type:i.ConnectionInit},S)),isFinite(g)&&g>0&&(y=setTimeout((()=>{d.close(n.ConnectionAcknowledgementTimeout,"Connection acknowledgement timeout")}),g)),w()}catch(e){I.emit("error",e),d.close(n.InternalClientError,o(e instanceof Error?e.message:new Error(e).message,"Internal client error"))}};let h=!1;d.onmessage=({data:t})=>{try{const o=function(e,t){return a("string"==typeof e?JSON.parse(e,t):e)}(t,C);if(I.emit("message",o),"ping"===o.type||"pong"===o.type)return I.emit(o.type,!0,o.payload),void("pong"===o.type?w():m||(d.send(s(o.payload?{type:i.Pong,payload:o.payload}:{type:i.Pong})),I.emit("pong",!1,o.payload)));if(h)return;if(o.type!==i.ConnectionAck)throw new Error(`First message cannot be of type ${o.type}`);clearTimeout(y),h=!0,I.emit("connected",d,o.payload),M=!1,O=0,e([d,new Promise(((e,t)=>P(t)))])}catch(e){d.onmessage=null,I.emit("error",e),d.close(n.BadResponse,o(e instanceof Error?e.message:new Error(e).message,"Bad response"))}}})())));e.readyState===N.CLOSING&&await p;let d=()=>{};const f=new Promise((e=>d=e));return[e,d,Promise.race([f.then((()=>{if(!q){const t=()=>e.close(1e3,"Normal Closure");isFinite(y)&&y>0?A=setTimeout((()=>{e.readyState===N.OPEN&&t()}),y):t()}})),p])]}function j(e){if(c(e)&&(t=e.code,![1e3,1001,1006,1005,1012,1013,1013].includes(t)&&t>=1e3&&t<=1999||[n.InternalServerError,n.InternalClientError,n.BadRequest,n.BadResponse,n.Unauthorized,n.SubprotocolNotAcceptable,n.SubscriberAlreadyExists,n.TooManyInitialisationRequests].includes(e.code)))throw e;var t;if(R)return!1;if(c(e)&&1e3===e.code)return q>0;if(!f||O>=f)throw e;if(!w(e))throw e;if(null==h?void 0:h(e))throw e;return M=!0}return p||(async()=>{for(q++;;)try{const[,,e]=await W();await e}catch(e){try{if(!j(e))return}catch(e){return null==d?void 0:d(e)}}})(),{on:I.on,subscribe(e,t){const o=v(e);let r=!1,n=!1,a=()=>{q--,r=!0};return(async()=>{for(q++;;)try{const[c,l,p]=await W();if(r)return l();const d=I.onMessage(o,(e=>{switch(e.type){case i.Next:return void t.next(e.payload);case i.Error:return n=!0,r=!0,t.error(e.payload),void a();case i.Complete:return r=!0,void a()}}));return c.send(s({id:o,type:i.Subscribe,payload:e},S)),a=()=>{r||c.readyState!==N.OPEN||c.send(s({id:o,type:i.Complete},S)),q--,r=!0,l()},void await p.finally(d)}catch(e){if(!j(e))return}})().then((()=>{n||t.complete()})).catch((e=>{t.error(e)})),()=>{r||a()}},async dispose(){if(R=!0,T){const[e]=await T;e.close(1e3,"Normal Closure")}},terminate(){T&&I.emit("closed",{code:4499,reason:"Terminated",wasClean:!1})}}}({url:"ws://localhost:8080/graphql"});(async()=>{await new Promise(((e,o)=>{let r;t.subscribe({query:'query { hello( name: "World") { message } }'},{next:e=>r=e,error:o,complete:()=>e(r)})}))})(),(async()=>{const e=e=>{console.log(e.data.files)};await new Promise(((o,r)=>{t.subscribe({query:"subscription { files { path } }"},{next:e,error:r,complete:o})}))})()}))})();